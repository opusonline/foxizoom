/*!
 * foxizoom 0.8
 * Author: Stefan Benicke
 * Copyright: GPL 3
 */
(function(a){var b={zoomWidth:"auto",zoomHeight:"auto",xOffset:10,yOffset:0,title:true,preload:true,position:"right",fadeSpeed:200,smoothMove:3,onStart:function(){},onComplete:function(){},onClose:function(){}};a.fn.foxizoomDefaults=function(c){a.extend(b,c);return this};a.fn.foxizoom=function(c){var c=a.extend({},b,c);if(a("#foxizoom").length==0){a("body").append('<div id="foxizoom"><div id="foxizoom_image_container"><div id="foxizoom_title"></div><img id="foxizoom_image" /></div></div><div id="foxizoom_lens"></div>')}return this.each(function(){var B=c,u=a(this),m=u.children("img"),A=u.attr("href"),P=u.attr("rel"),t=new Image(),F=false,M=parseInt(m.css("border-top-width")),d=parseInt(m.css("border-left-width")),g=Math.round(m.offset().top)+(isNaN(M)?0:M)+parseInt(m.css("padding-top")),Q=Math.round(m.offset().left)+(isNaN(d)?0:d)+parseInt(m.css("padding-left")),f=Math.round(m.width()),p=Math.round(m.height()),G=u.attr("title")||m.attr("title"),h=a("#foxizoom"),k=a("#foxizoom_title"),w=a("#foxizoom_image_container"),L=a("#foxizoom_image"),N=a("#foxizoom_lens"),o,J,y,R,z,r,i,O,q,n,l,x,s,I,E,j,D=false;if(P!=""){eval("var K={"+P+"}");B=a.extend({},B,K)}if(B.smoothMove<1){B.smoothMove=1}a('<div class="foxizoom_chair" style="top:'+g+"px;left:"+Q+"px;width:"+f+"px;height:"+p+'px"></div>').appendTo("body").bind("mouseenter",T).bind("mouseleave",e).bind("mousemove",H);if(B.preload){S()}function S(){if(F){return}try{t.src=A}catch(U){D=true}t.onload=function(){F=true};t.onerror=function(){D=true}}function T(V){s=V.pageY;I=V.pageX;B.onStart.call(u);y=B.zoomWidth=="auto"?f:B.zoomWidth;R=B.zoomHeight=="auto"?p:B.zoomHeight;if(B.position=="inside"){o=g;J=Q;y=f;R=p;h.addClass("inside")}else{o=g+B.yOffset;J=B.position=="right"?Q+f+B.xOffset:Q-B.xOffset-y;h.removeClass("inside")}if(G!=""&&B.title){var U=G;if(typeof B.title=="function"){U=B.title.call(u,G)}k.html(U).show()}else{k.hide()}L.hide();w.css({width:y,height:R});h.css({top:o,left:J}).stop(true,true).fadeIn(B.fadeSpeed);if(!F){w.addClass("loading")}if(!B.preload){S()}C()}function e(){clearTimeout(E);clearTimeout(j);if(F&&B.position!="inside"){N.hide()}h.fadeOut(B.fadeSpeed,function(){B.onClose.call(u)})}function H(U){s=U.pageY;I=U.pageX}function C(){if(!F){if(!D){j=setTimeout(C,100)}return}w.removeClass("loading");z=Math.round(f/t.width*y);r=Math.round(p/t.height*R);n=Q+f-z;q=g+p-r;i=Math.round(s-r/2);O=Math.round(I-z/2);if(i<g){i=g}if(i>q){i=q}if(O<Q){O=Q}if(O>n){O=n}if(B.position!="inside"){N.css({width:z,height:r,top:i,left:O}).show()}l=Math.round(t.height/p*(i-g))*-1;x=Math.round(t.width/f*(O-Q))*-1;L.attr("src",t.src).css({width:t.width,height:t.height,top:l,left:x}).show();B.onComplete.call(u);v()}function v(){i=Math.round(s-r/2);O=Math.round(I-z/2);if(i<g){i=g}if(i>q){i=q}if(O<Q){O=Q}if(O>n){O=n}if(B.position!="inside"){N.css({top:i,left:O})}var V=t.height/p*(i-g),U=t.width/f*(O-Q);l+=Math.round((-V-l)/B.smoothMove);x+=Math.round((-U-x)/B.smoothMove);L.css({top:l,left:x});E=setTimeout(v,30)}})}})(jQuery);