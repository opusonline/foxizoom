/*!
 * name: foxizoom
 * author: Stefan Benicke - www.opusonline.at
 * version: 0.9
 * last update: 21.02.2011
 * category: jQuery plugin
 * license: GNU GPLv3
 */
(function(a){var b={zoomWidth:"auto",zoomHeight:"auto",xOffset:10,yOffset:0,title:true,preload:true,position:"right",fadeSpeed:200,smoothMove:3,onStart:function(){},onComplete:function(){},onClose:function(){}};a.fn.foxizoomDefaults=function(c){a.extend(b,c);return this};a.fn.foxizoom=function(d){var d=a.extend({},b,d),c='<div class="foxizoom_image_container"><div class="foxizoom_title"></div><img class="foxizoom_image" /></div>';if(!a("#foxizoom").length){a("body").append('<div id="foxizoom">'+c+'</div><div id="foxizoom_lens"></div>')}return this.each(function(){var C=d,v=a(this),n=v.children("img"),B=v.attr("href"),Q=v.attr("rel"),u=new Image(),G=false,N=parseInt(n.css("border-top-width")),e=parseInt(n.css("border-left-width")),h=Math.round(n.offset().top)+(isNaN(N)?0:N)+parseInt(n.css("padding-top")),R=Math.round(n.offset().left)+(isNaN(e)?0:e)+parseInt(n.css("padding-left")),g=Math.round(n.width()),q=Math.round(n.height()),H=v.attr("title")||n.attr("title"),O=a("#foxizoom_lens"),p,K,z,S,A,s,j,P,r,o,m,y,t,J,F,k,E=false;if(Q!=""){eval("var M={"+Q+"}");C=a.extend({},C,M)}var U=C.position.match(/^#[^\ ]+/gi);if(U){var W=a(U[0]);if(!W.length){U=null}if(!W.data("set")){W.html(c).data("set",true)}}var i=U?W:a("#foxizoom"),l=i.find(".foxizoom_title"),x=i.find(".foxizoom_image_container"),L=i.find(".foxizoom_image");if(C.smoothMove<1){C.smoothMove=1}a('<div class="foxizoom_layer" style="top:'+h+"px;left:"+R+"px;width:"+g+"px;height:"+q+'px"></div>').appendTo("body").bind("mouseenter",V).bind("mouseleave",f).bind("mousemove",I);if(C.preload){T()}function T(){if(G){return}try{u.src=B}catch(X){E=true}u.onload=function(){G=true};u.onerror=function(){E=true}}function V(Y){t=Y.pageY;J=Y.pageX;C.onStart.call(v);z=C.zoomWidth=="auto"?g:C.zoomWidth;S=C.zoomHeight=="auto"?q:C.zoomHeight;if(C.position=="inside"){p=h;K=R;z=g;S=q;i.addClass("inside")}else{if(!U){p=h+C.yOffset;K=C.position=="left"?R-C.xOffset-z:R+g+C.xOffset;i.removeClass("inside")}}if(U){z=i.width();S=i.height()}if(H!=""&&C.title){var X=H;if(typeof C.title=="function"){X=C.title.call(v,H)}l.html(X).show()}else{l.hide()}L.hide();x.css({width:z,height:S});if(!U){i.css({top:p,left:K})}i.stop(true,true).fadeIn(C.fadeSpeed);if(!G){x.addClass("loading")}if(!C.preload){T()}D()}function f(){clearTimeout(F);clearTimeout(k);if(G&&C.position!="inside"){O.hide()}i.fadeOut(C.fadeSpeed,function(){C.onClose.call(v)})}function I(X){t=X.pageY;J=X.pageX}function D(){if(!G){if(!E){k=setTimeout(D,100)}return}x.removeClass("loading");A=Math.round(g/u.width*z);s=Math.round(q/u.height*S);o=R+g-A;r=h+q-s;j=Math.round(t-s/2);P=Math.round(J-A/2);if(j<h){j=h}if(j>r){j=r}if(P<R){P=R}if(P>o){P=o}if(C.position!="inside"){O.css({width:A,height:s,top:j,left:P}).show()}m=Math.round(u.height/q*(j-h))*-1;y=Math.round(u.width/g*(P-R))*-1;L.attr("src",u.src).css({width:u.width,height:u.height,top:m,left:y}).show();C.onComplete.call(v);w()}function w(){j=Math.round(t-s/2);P=Math.round(J-A/2);if(j<h){j=h}if(j>r){j=r}if(P<R){P=R}if(P>o){P=o}if(C.position!="inside"){O.css({top:j,left:P})}var Y=u.height/q*(j-h),X=u.width/g*(P-R);m+=Math.round((-Y-m)/C.smoothMove);y+=Math.round((-X-y)/C.smoothMove);L.css({top:m,left:y});F=setTimeout(w,30)}})}})(jQuery);